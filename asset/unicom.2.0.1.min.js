"use strict";function _defineProperty(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,r=Array(t.length);n<t.length;n++)r[n]=t[n];return r}return Array.from(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,r,i){return r&&t(n.prototype,r),i&&t(n,i),n}}(),_slicedToArray=function(){function t(t,n){var r=[],i=!0,e=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(r.push(a.value),!n||r.length!==n);i=!0);}catch(t){e=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(e)throw o}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,n){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.VueUnicom=n()}(window,function(){function t(t,n,r){r&&u[r]==t&&delete u[r],n&&(u[n]=t)}function n(t,n){var r=s[n];r||(r=s[n]=[]),r.indexOf(t)<0&&r.push(t)}function r(t,r,i){i&&i.forEach(function(n){var r=s[n];if(r){var i=r.indexOf(t);i>-1&&r.splice(i,1)}}),r&&r.forEach(function(r){n(t,r)})}function i(t){f.push(t)}function e(t){var n=f.indexOf(t);n>-1&&f.splice(n,1)}function o(t,n,r,i,e){var o=[];if("#"==n){var a=u[r];if(!i)return a;a&&o.push(a)}else if("@"==n){var l=s[r];if(!i)return l;l&&o.push.apply(o,_toConsumableArray(l))}else o.push.apply(o,f);var h=new c(t,e);return o.forEach(function(t){t.emit.apply(t,[i,h].concat(_toConsumableArray(e)))}),h}function a(t){for(var n=0;n<l.length;n+=1){var r=_slicedToArray(l[n],3),i=r[0],e=r[1],o=r[2];("#"==i&&t.id==e||"@"==i&&t.group.indexOf(e)>-1)&&o(t)}}var u={},s={},f=[],c=function t(n,r){var i=this;_classCallCheck(this,t),this.from=n,this.target=n.target,this.data=r[0],r.forEach(function(t,n){i["$"+(n+1)]=t})},l=[],h=function(){function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.id,r=t.group,e=t.target,o=void 0===e?null:e;_classCallCheck(this,u),this._instruct_={};var a=this._instruct_;if(a)for(var s in a){var f;this._instruct_[s]=(f=[]).push.apply(f,_toConsumableArray(a[s]))}this.target=o,this.group=[],n&&this.setId(n),r&&this.setGroup(r),i(this),this.monitorBack()}return _createClass(u,[{key:"monitorBack",value:function(){var t=this;clearTimeout(this._monitor_back_),this._monitor_back_=setTimeout(function(){a(t)},1)}},{key:"monitor",value:function(t,n){var r=t.slice(0,1),i=t.slice(1,t.length);l.push([r,i,n,this])}},{key:"monitorOff",value:function(t,n){for(var r=0;r<l.length;){var i=_slicedToArray(l[r],4),e=i[0],o=i[1],a=i[2];i[3]!=this||t&&t!=e+o||n&&n!=a?r+=1:l.splice(r,1)}}},{key:"destroy",value:function(){e(this),t(this,null,this.id),r(this,null,this.group),this.monitorOff(),this.off()}},{key:"setId",value:function(n){return this.id!=n&&(t(this,n,this.id),this.id=n,this.monitorBack()),this}},{key:"setGroup",value:function(t){return"string"==typeof t?(this.group.push(t),n(this,t),this):(r(this,t,this.group),this.group=t,this.monitorBack(),this)}},{key:"has",value:function(t){var n=(this._instruct_||{})[t];return!!(n&&n.length>0)}},{key:"on",value:function(t,n){var r=this._instruct_||(this._instruct_={});return r[t]||(r[t]=[]),r[t].push(n),this}},{key:"off",value:function(t,n){var r=this._instruct_;if(r)if(n){var i=r[t];if(i){var e=i.indexOf(n);e>-1&&i.splice(e,1),0==i.length&&delete r[t]}}else t?delete r[t]:delete this._instruct_;return this}},{key:"emit",value:function(t){for(var n=this,r=arguments.length,i=Array(r>1?r-1:0),e=1;e<r;e++)i[e-1]=arguments[e];var a=i[0];if(a&&a.constructor==c){return(this._instruct_&&this._instruct_[t]||[]).forEach(function(t){t.apply(n.target||n,i)}),a}var u=void 0,s=void 0,f=void 0;return f=t.replace(/([@#])([^@#]*)$/,function(t,n,r){return s=r,u=n,""}),o(this,u,s,f,i)}}]),u}(),p=!1;return h.install=function(t){function n(t){var n=t._unicom_data_,r=t[d]||[];return n.initGroup.concat(r)}var r,i,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.name,a=void 0===o?"unicom":o,u=e.unicomName,s=e.unicomId,f=e.unicomEmit,c=e.unicomClass;if(!p){p=!0;var l=f||a;t.prototype["$"+l]=function(){var t;return(t=this._unicom_data_.self).emit.apply(t,arguments)};var y=c;y||(y=a.replace(/^\w/,function(t){return t.toUpperCase()})),t[y]=h;var v=s||a+"Id",d=u||a+"Name";t.mixin({props:(r={},_defineProperty(r,v,{type:String,default:""}),_defineProperty(r,d,{type:[String,Array],default:""}),r),watch:(i={},_defineProperty(i,v,function(t){var n=this._unicom_data_&&this._unicom_data_.self;n&&n.setId(t)}),_defineProperty(i,d,function(){var t=this._unicom_data_&&this._unicom_data_.self;t&&t.setGroup(n(this))}),i),beforeCreate:function(){var t=!this.$vnode||/-transition$/.test(this.$vnode.tag),n=this._unicom_data_={isIgnore:t};if(!t){var r=this.$options;n.initGroup=r[d]||[],n.channels=r[a]||[]}},created:function(){var t=this._unicom_data_;if(!t.isIgnore){var r=t.self=new h({target:this,id:this[v],group:n(this),subs:t.channels});t.channels.forEach(function(t){for(var n in t)r.on(n,t[n])})}},destroyed:function(){var t=this._unicom_data_;t.isIgnore||t.self.destroy()}});var _=t.config.optionMergeStrategies;_[a]=function(t,n){var r=t||[];return n&&r.push(n),r},_[d]=function(t,n){var r=t||[];return n&&("string"==typeof n?r.push(n):r.push.apply(r,_toConsumableArray(n))),r}}},h});